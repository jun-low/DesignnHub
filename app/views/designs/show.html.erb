<div class="fluid-container">
  <div class="row" >
    <div class="col-12 col-xl-8" style="margin: 0; padding: 0;" >

      <div class="main-show-container">
          <div class="js-design-photo-pinner design-photo-pinner">
            <div class="design-photo-image-wrapper">
              <%= cl_image_tag @design.photo, height: 620 %>
              <% if @comments.nil? %>
                <p>No comments</p>
              <% else %>
                <% @comments.each.with_index do |comment, index| %>
                  <% if comment.x.nil? || comment.y.nil? %>
                    <div data-comment-id="<%=comment.id%>" class="design-photo-pin"></div>
                  <% else %>
                    <div data-comment-id="<%=comment.id%>" class="design-photo-pin visible" style="top: <%= (comment.y * 100) %>%; left: <%= comment.x * 100 %>%;">
                      <%= index + 1 %>
                    </div>
                  <% end %>
                <% end %>
              <% end %>
              <div class ="js-design-photo-pin design-photo-pin-user" >
                <div class="design-photo-pin visible">
                  <%= @comments.count + 1 %>
                </div>
                <div class="popup-comment-form d-none js-popup-comment-form">
                  <%= render 'new_comment' %>
                </div>
              </div>
              <div class="eye-button">
                <button id="toggle-pins-button" onclick="togglePins()"><i class="fas fa-eye-slash"></i></button>
              </div>
            </div>


              <script>
                const pins = document.querySelectorAll(".design-photo-pin");
                const toggleButton = document.querySelector("#toggle-pins-button");

                function showCoords(event) {
                  var x = event.clientX;
                  var y = event.clientY;
                  var coords = [x,y];
                  document.getElementById("js-design-photo-pin").innerHTML = coords;
                };

                function showAllPins() {
                  pins.forEach((pin) => {
                    pin.classList.add("visible")
                  });
                }

                function hideAllPins() {
                  pins.forEach((pin) => {
                    pin.classList.remove("visible")
                  });
                }

                function togglePins() {
                  const visiblePins = document.querySelectorAll(".design-photo-pin.visible");

                  if (visiblePins.length === 0) {
                    toggleButton.innerHTML = "<i class=\"fas fa-eye-slash\"></i>";
                    showAllPins()
                  } else {
                    toggleButton.innerHTML = "<i class=\"fas fa-eye\"></i>";
                    hideAllPins()
                  }
                }

                function showPin(comment_id) {
                  var clickedPin = document.querySelector('[data-comment-id="' + comment_id + '"]');

                  hideAllPins();
                  clickedPin.classList.add("visible");
                  toggleButton.innerHTML = "<i class=\"fas fa-eye\"></i>";
                }

              </script>
          </div>
              <div class="design-description">
                <div class="design-meta-title">
                  <%= @design.title %>
                </div>
                <p class="design-meta-description">
                  <%= @design.description %>
                </p>
                <%= render partial: 'partials/author', locals: { user: @user, created_at: @design.created_at } %>

              </div>
      </div>
    </div>
      <div class="col-12 col-xl-4 comment-container" >
        <div class="overflow-auto comment-wrapper">
          <div class="comments">
            <%= render 'comments' %>
          </div>
        </div>
        <div class="new-comment">
          <%= render 'new_comment' %>
        </div>
      </div>
  </div>
</div>
